## Deployment란?
- Deployment는 쿠버네티스에서 애플리케이션의 배포와 업데이트를 관리하는 리소스
- deployment는 replicaset의 기능 사용 가능할 수 있음

Deployment를 생성하게면 다음과 같은 구조로 리소스가 생성됨
```
Deployment
    └── ReplicaSet
         └── Pod
```

- **Deployment**: 배포 기능, 히스토리 관리, 롤백 기능 제공
- **ReplicaSet (RS)**: Pod 복제본 관리
- **Pod**: 실제 컨테이너가 실행되는 최소 단위

## StatefultSet과 비교
- Deployment
- 가장 상위 개념
- ReplicaSet을 관리하고 생성
- 배포 전략, 롤백, 히스토리 관리 담당

- StatefulSet
- Deployment와 같은 레벨의 독립적인 컨트롤러
- Pod을 직접 관리 (RS를 사용하지 않음)
- 순차적인 Pod 생성과 고유한 네트워크 식별자 제공

### Deployment 주요 특징
- **상태 관리**: stateless(휘발성) 애플리케이션 배포에 사용
- **자동화**: Pod의 생성, 삭제, 업데이트를 자동으로 관리
- **버전 관리**: 롤백과 배포 이력 관리 가능
- **스케일링**: 손쉬운 확장/축소 가능

### 배포란?
- 서비스를 변경하고, 변경한 서비스로 업데이트하여 버전을 바꾸는 과정
- 배포하는 과정에서 **로드 밸런서**가 사용자의 요청을 어떤 버전의 서비스로 보낼지 결정하는 중요한 역할을 수행함

https://github.com/okhi3945/cwave4/issues/1#issue-2791717155
## 배포 전략 개요

다음은 사용 빈도순으로 정리한 주요 배포 전략들입니다:

1. Recreate (재생성)
2. Ramped (롤링 업데이트)
3. Blue/Green (블루/그린)
4. Canary (카나리)
5. A/B Testing (A/B 테스팅)
6. Shadow (섀도우)

## 전략별 상세 설명

### Recreate (재생성)
- **설명**: 기존 버전을 완전히 종료하고 새 버전으로 교체
- **장점**: 설정이 간단함
- **단점**: 서비스 영향이 크고, 롤백 시간이 김

### Ramped (롤링 업데이트)
- **설명**: 점진적으로 이전 인스턴스를 새 버전으로 교체
- **주요 개념**:
  - maxSurge: 설정된 레플리카 수 이상으로 존재할 수 있는 최대 파드 수
  - maxUnavailable: 업데이트 중 사용할 수 없는 최대 파드 수
- **적합한 경우**: 무중단 배포가 필요한 일반적인 상황
- 최대 파드 개수와 최소 떠있어야하는 파드 개수의 간격이 크면 클수록 재가동 속도는 빨라짐

#### 추가 설명명
- if replica=3, maxSurge=2, maxUnavailable=1이면 
- 최대로 존재할 수 있는 파드 수 = 5개 (replicas 3 + maxSurge 2)
- 최소로 실행되어야 하는 파드 수 = 2개 (replicas 3 - maxUnavailable 1)
- maxSurge와 maxUnavailable의 값을 크게 설정할 수록 한 번에 더 많은 파드를 새 버전으로 교체할 수 있어서
- 전체적인 업데이트 속도가 빨라짐

### Blue/Green (블루/그린), Red/Black으로 부르기도함
- **설명**: 두 개의 동일한 환경을 운영하며 트래픽을 한 번에 전환, v1에 연결되어 있는 LB의 특정 **퍼센트**를 v2에 골고루 10%, 20% ... 계속 연결하여 100%까지 연결
- **장점**: 롤백이 쉽고, 프론트엔드 서비스에 적합
- **적합한 경우**: 빠른 롤백 기능이 필요한 애플리케이션
- **참고**: 서비스 메시(예: Istio) 필요, yaml 파일에서 weight값을 설정하여 v1과 v2로 향하는 트래픽의 퍼센트 비율을 설정할 수 있음

### Canary (카나리)
- **설명**: 특정 비율의 트래픽을 새 버전으로 전달
- **장점**: 실제 트래픽으로 통제된 테스트 가능
- **적합한 경우**: 프로덕션 환경에서의 위험 완화
- **참고**: 고급 로드 밸런서 필요

### A/B Testing (A/B 테스팅)
- **설명**: 특정 조건(possible conditions, 예: 데스크톱 vs 모바일)에 따라 트래픽 라우팅
- **장점**: 
  - 여러 버전의 애플리케이션 동시 서비스 가능
  - 트래픽 분배에 대한 완전한 제어
- **단점**: 지능형 로드 밸런서(Istio, Linkerd) 필요

### Shadow (섀도우)
- **설명**: 프로덕션 트래픽을 새 버전으로 복사하여 테스트
- **장점**:
  - 사용자 영향 없음
  - 성능 테스트에 적합
  - Canary, Blue/Green과 함께 사용 가능
- **단점**:
  - 설정이 복잡
  - 2배의 리소스 필요
  - 목업 서비스 필요

## 전략 선택 가이드

요구사항에 따른 Deploy 전략 선택:
- **다운타임 허용해도 될 때**: Recreate
- **무중단 배포 필요할 때**: Ramped, Blue/Green
- **실제 트래픽 테스트를 해야할 때**: Canary, A/B Testing, Shadow
- **사용자 타겟팅 필요 ex) 시각장애인용 앱 UI**: A/B Testing
- **서비스 메시 없는 환경**: Recreate와 Rolling Update만 사용 가능

## 쿠버네티스 지원

기본 배포에서 지원하는 전략:
- Recreate
- Rolling Update (기본값)

## 추가 도구가 필요한 전략
Blue/Green, Canary, A/B Testing, Shadow의 경우 **서비스 메시(Istio, Linkerd)**와 같은 추가 도구가 필요함.
